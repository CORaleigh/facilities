<form [formGroup]="myForm" novalidate (ngSubmit)="save(myForm.value, myForm.valid)">

    <mat-card>
        <mat-card-title>Select Facility</mat-card-title>
        <mat-card-content>
            <mat-form-field>
                <mat-select formControlName="loc" required placeholder='Select a facility...'>
                    <mat-option *ngFor="let location of locations" [value]="location">{{location.descr}}</mat-option>
                </mat-select>
            </mat-form-field>
        </mat-card-content>
    </mat-card>
    <mat-card>
        <mat-card-title>Select Problem</mat-card-title>
        <mat-card-content>
            <mat-form-field>
                <mat-select formControlName="problemCode" required placeholder='Select a problem...'>
                    <mat-option *ngFor="let problem of problems" [value]="problem">{{problem.descr}}</mat-option>
                </mat-select>
            </mat-form-field>
            <mat-progress-bar *ngIf="showSpinner" class="app-spinner" mode="indeterminate" aria-label="Indeterminate progress-bar example"></mat-progress-bar>
        </mat-card-content>
    </mat-card>
    <mat-card>
        <mat-card-title>Answer Questions</mat-card-title>
        <mat-card-content>

            <span *ngFor="let q of questions; let i = index">
                <ng-container *ngIf="i<1">
                    {{q.Question}}
                </ng-container>
                <br>
                    <mat-form-field *ngIf="i < 1">
                        <mat-select *ngIf="q.Question" required placeholder='Select an answer...'>
                            <mat-option *ngFor="let a of answerPerQuestion" [value]="a">{{a}}</mat-option>
                        </mat-select>
                    </mat-form-field>
                    <br>
                <ng-container *ngIf="i < questions.length && i === 1">
                    {{q.Question}}
                </ng-container>
            </span>
        </mat-card-content>
    </mat-card>
    <mat-card>
        <mat-card-title>Enter your contact information</mat-card-title>

        <mat-card-content>
            <mat-form-field>
                <input matInput type="text" formControlName="callerFirstName" placeholder="First Name">
            </mat-form-field>

            <mat-form-field>
                <input matInput type="text" formControlName="callerLastName" placeholder="Last Name">
            </mat-form-field>

            <mat-form-field>
                <input matInput type="text" formControlName="callerEmail" placeholder="Email">
            </mat-form-field>
            <mat-form-field>
                <input matInput type="text" formControlName="callerWorkPhone" placeholder="Phone #" type="number">
            </mat-form-field>
            <mat-form-field>
                <textarea matInput type="text" formControlName="comments" placeholder="Comments"></textarea>
            </mat-form-field>
        </mat-card-content>
        <p>
            <button mat-raised-button color="primary" type="submit" class="btn btn-success" [disabled]="!myForm.valid || submitted">Submit</button>
        </p>
        <p>
            <mat-progress-bar *ngIf="!isDone && submitted" class="app-progress" mode="indeterminate" aria-label="Indeterminate progress-bar example"></mat-progress-bar>
        </p>

        <div *ngIf="isDone && authResponse.requestId == ''">There was a problem generating your Service Request. Please try again. {{authResponse.message}}</div>
        <div *ngIf="isDone && authResponse.requestId != ''">Your Service Request ID is {{authResponse.requestId | json}}</div>
    </mat-card>
</form>
<mat-card>
    <app-map></app-map>
</mat-card>